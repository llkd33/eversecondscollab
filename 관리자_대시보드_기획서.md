# 관리자 대시보드 기획서

## 📊 개요

### 1.1 목적
플랫폼 운영자를 위한 통합 관리 시스템으로 실시간 모니터링, 데이터 분석, 사용자 관리 기능 제공

### 1.2 타겟 사용자
- 플랫폼 관리자
- 운영팀
- 데이터 분석가

### 1.3 주요 목표
- 실시간 플랫폼 상태 모니터링
- 효율적인 상품/사용자 관리
- 데이터 기반 의사결정 지원
- 시스템 보안 및 품질 관리

---

## 🎯 핵심 기능

### 2.1 기능 목록

| 기능 카테고리 | 세부 기능 | 우선순위 | 설명 |
|-------------|---------|----------|------|
| **대시보드** | 실시간 통계 | P0 | KPI, 차트, 최근 활동 |
| **상품 관리** | 상품 목록/검색 | P0 | 전체 상품 조회 및 관리 |
| | 상품 상태 변경 | P0 | 승인/거부/삭제 |
| | 카테고리 관리 | P1 | 카테고리 CRUD |
| **사용자 관리** | 회원 목록 | P0 | 전체 회원 조회 |
| | 권한 관리 | P0 | 관리자/일반 사용자 |
| | 계정 제재 | P1 | 정지/차단 |
| **거래 관리** | 거래 내역 | P0 | 전체 거래 추적 |
| | 거래 통계 | P1 | 성사율, 평균 거래액 |
| **신고 관리** | 신고 목록 | P1 | 부적절 상품/사용자 |
| | 신고 처리 | P1 | 승인/기각 |
| **통계 분석** | 판매 통계 | P1 | 카테고리별, 기간별 |
| | 사용자 분석 | P1 | 활동 패턴, 리텐션 |
| **시스템** | 로그 관리 | P2 | 시스템 로그 조회 |
| | 설정 | P2 | 플랫폼 설정 |

---

## 🖥️ 화면 설계

### 3.1 전체 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│ 에버세컨즈 관리자 🎯                    관리자님 👤  로그아웃│
├───────────┬─────────────────────────────────────────────────┤
│           │                                                 │
│ 📊 대시보드 │               메인 컨텐츠 영역                  │
│           │                                                 │
│ 📦 상품관리 │                                                 │
│  └ 상품목록 │                                                 │
│  └ 카테고리 │                                                 │
│           │                                                 │
│ 👥 사용자   │                                                 │
│  └ 회원목록 │                                                 │
│  └ 권한관리 │                                                 │
│           │                                                 │
│ 💰 거래관리 │                                                 │
│  └ 거래내역 │                                                 │
│  └ 통계    │                                                 │
│           │                                                 │
│ ⚠️ 신고관리 │                                                 │
│           │                                                 │
│ 📈 통계분석 │                                                 │
│  └ 판매통계 │                                                 │
│  └ 사용자분석│                                                 │
│           │                                                 │
│ ⚙️ 시스템   │                                                 │
│  └ 로그관리 │                                                 │
│  └ 설정    │                                                 │
│           │                                                 │
└───────────┴─────────────────────────────────────────────────┘
```

---

### 3.2 화면 1: 대시보드 (홈)

**목적**: 플랫폼 전체 현황 한눈에 파악

**레이아웃**:
```
┌─────────────────────────────────────────────────────────────┐
│ 대시보드                                    오늘 2025.10.30  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  주요 지표 (오늘)                                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ 📦 신규 상품  │  │ 👥 신규 회원 │  │ 💰 거래 건수 │     │
│  │     42개     │  │     28명     │  │     15건     │     │
│  │  ↑ 12% vs 어제│  │  ↑ 8% vs 어제│  │  ↓ 5% vs 어제│     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ 👀 총 조회수 │  │ ⚠️ 신규 신고 │  │ 🔄 활성 사용자│     │
│  │   1,234회    │  │     3건      │  │     156명    │     │
│  │  ↑ 15% vs 어제│  │  → 0% vs 어제│  │  ↑ 10% vs 어제│     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                             │
│  ───────────────────────────────────────────────────────── │
│                                                             │
│  판매 트렌드 (최근 7일)                                      │
│  ┌──────────────────────────────────────────────────────┐ │
│  │  판매액                                              │ │
│  │  (만원)                                              │ │
│  │   500│                                    ●          │ │
│  │   400│                            ●                  │ │
│  │   300│                    ●                          │ │
│  │   200│            ●                                  │ │
│  │   100│    ●                                          │ │
│  │      └────────────────────────────────────────────  │ │
│  │       월  화  수  목  금  토  일                      │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                             │
│  ───────────────────────────────────────────────────────── │
│                                                             │
│  최근 등록 상품                                    [더보기]  │
│  ┌────────────────────────────────────────────────────────┐│
│  │ ID      │ 상품명            │ 판매자  │ 가격   │ 상태  ││
│  │─────────┼──────────────────┼────────┼───────┼──────││
│  │ PR-1234 │ 아이폰 13 Pro     │ 홍길동  │ 80만원 │ 🟢활성 ││
│  │ PR-1233 │ 갤럭시 버즈 프로   │ 김철수  │ 12만원 │ 🟢활성 ││
│  │ PR-1232 │ 맥북 프로 M1      │ 이영희  │ 210만원│ 🟢활성 ││
│  └────────────────────────────────────────────────────────┘│
│                                                             │
│  최근 회원 가입                                    [더보기]  │
│  ┌────────────────────────────────────────────────────────┐│
│  │ ID     │ 이름   │ 이메일             │ 가입일     │ 상태││
│  │────────┼───────┼───────────────────┼──────────┼─────││
│  │ U-9876 │ 박민수 │ minsu@kakao.com    │ 2시간 전  │ 활성││
│  │ U-9875 │ 정수진 │ sujin@kakao.com    │ 5시간 전  │ 활성││
│  │ U-9874 │ 최영호 │ youngho@kakao.com  │ 1일 전    │ 활성││
│  └────────────────────────────────────────────────────────┘│
│                                                             │
│  최근 신고                                         [더보기]  │
│  ┌────────────────────────────────────────────────────────┐│
│  │ 신고 내용             │ 신고자  │ 대상    │ 일시      ││
│  │──────────────────────┼────────┼────────┼──────────││
│  │ 부적절한 상품 이미지   │ 김철수  │ PR-1230│ 1시간 전  ││
│  │ 사기 의심             │ 이영희  │ U-9800 │ 3시간 전  ││
│  └────────────────────────────────────────────────────────┘│
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**KPI 카드 데이터 로딩**:
```typescript
interface DashboardKPIs {
  newProductsToday: { count: number; change: number };
  newUsersToday: { count: number; change: number };
  transactionsToday: { count: number; change: number };
  totalViewsToday: { count: number; change: number };
  newReportsToday: { count: number; change: number };
  activeUsers: { count: number; change: number };
}

async function fetchDashboardKPIs(): Promise<DashboardKPIs> {
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);

  // 오늘의 데이터
  const { data: todayData } = await supabase.rpc('get_dashboard_kpis', {
    start_date: today.toISOString().split('T')[0],
    end_date: today.toISOString().split('T')[0],
  });

  // 어제의 데이터 (비교용)
  const { data: yesterdayData } = await supabase.rpc('get_dashboard_kpis', {
    start_date: yesterday.toISOString().split('T')[0],
    end_date: yesterday.toISOString().split('T')[0],
  });

  // 변화율 계산
  const calculateChange = (today: number, yesterday: number) => {
    if (yesterday === 0) return 0;
    return ((today - yesterday) / yesterday) * 100;
  };

  return {
    newProductsToday: {
      count: todayData.new_products,
      change: calculateChange(todayData.new_products, yesterdayData.new_products),
    },
    // ... 나머지 KPI
  };
}
```

---

### 3.3 화면 2: 상품 목록 관리

**목적**: 전체 상품 조회 및 관리

**레이아웃**:
```
┌─────────────────────────────────────────────────────────────┐
│ 상품 관리 > 상품 목록                                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [🔍 검색]  [카테고리 ▼]  [상태 ▼]  [정렬 ▼]     [📥 내보내기]│
│                                                             │
│  전체 1,234개 상품                                           │
│  ┌──────────────────────────────────────────────────────┐  │
│  │┌───┐│ ID      │ 상품명        │ 판매자│ 가격  │ 상태│액션││
│  ││img│├─────────┼──────────────┼──────┼──────┼────┼───││
│  │└───┘│ PR-1234 │ 아이폰 13 Pro │홍길동 │ 80만원│🟢  │⋮  ││
│  │      │         │ 그래파이트     │      │      │활성│   ││
│  │      │         │ 조회 124 · 1일 전                      ││
│  │─────────────────────────────────────────────────────────││
│  │┌───┐│ PR-1233 │ 갤럭시 버즈   │김철수 │ 12만원│🟢  │⋮  ││
│  ││img│├─────────┼──────────────┼──────┼──────┼────┼───││
│  │└───┘│         │ 프로          │      │      │활성│   ││
│  │      │         │ 조회 58 · 1일 전                       ││
│  │─────────────────────────────────────────────────────────││
│  │┌───┐│ PR-1232 │ 맥북 프로 M1  │이영희 │210만원│🟡  │⋮  ││
│  ││img│├─────────┼──────────────┼──────┼──────┼────┼───││
│  │└───┘│         │               │      │      │대기│   ││
│  │      │         │ 조회 5 · 방금 전                       ││
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ◀  1  2  3 ... 50  ▶                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘

액션 메뉴 (⋮ 클릭 시):
┌─────────────┐
│ 📄 상세보기  │
│ ✏️ 수정     │
│ ✅ 승인     │
│ ❌ 거부     │
│ 🗑️ 삭제     │
│ 📊 통계보기  │
└─────────────┘
```

**상품 관리 기능**:
```typescript
// 상품 상태 변경
async function updateProductStatus(
  productId: string,
  status: 'active' | 'pending' | 'rejected' | 'sold' | 'hidden',
  reason?: string
) {
  const { error } = await supabase
    .from('products')
    .update({
      status,
      updated_at: new Date().toISOString(),
    })
    .eq('id', productId);

  if (error) throw error;

  // 로그 기록
  await supabase.from('admin_logs').insert({
    admin_id: currentAdmin.id,
    action: 'update_product_status',
    target_type: 'product',
    target_id: productId,
    details: { status, reason },
    created_at: new Date().toISOString(),
  });

  // 판매자에게 알림 (상태에 따라)
  if (status === 'rejected') {
    await sendNotification(productId, 'product_rejected', { reason });
  }
}

// 대량 작업
async function bulkUpdateProducts(productIds: string[], action: string) {
  // 트랜잭션으로 처리
  const { error } = await supabase.rpc('bulk_update_products', {
    product_ids: productIds,
    action: action,
    admin_id: currentAdmin.id,
  });

  if (error) throw error;
}

// 상품 삭제 (소프트 삭제)
async function deleteProduct(productId: string, reason: string) {
  const { error } = await supabase
    .from('products')
    .update({
      status: 'deleted',
      deleted_at: new Date().toISOString(),
      deleted_reason: reason,
    })
    .eq('id', productId);

  if (error) throw error;
}
```

---

### 3.4 화면 3: 사용자 관리

**목적**: 회원 조회 및 관리

**레이아웃**:
```
┌─────────────────────────────────────────────────────────────┐
│ 사용자 관리 > 회원 목록                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [🔍 검색: 이름, 이메일]  [역할 ▼]  [상태 ▼]    [📥 내보내기]│
│                                                             │
│  전체 2,456명 회원                                           │
│  ┌──────────────────────────────────────────────────────┐  │
│  │┌───┐│ ID    │ 이름  │ 이메일          │가입일 │ 역할│액션││
│  ││👤 │├───────┼──────┼────────────────┼──────┼────┼───││
│  │└───┘│U-9876 │홍길동 │gildong@kakao...│5일전  │일반│⋮  ││
│  │      │       │등록 12 · 판매 8 · ⭐4.8             ││
│  │─────────────────────────────────────────────────────────││
│  │┌───┐│U-9875 │김철수 │cheolsu@kakao...│10일전 │일반│⋮  ││
│  ││👤 │├───────┼──────┼────────────────┼──────┼────┼───││
│  │└───┘│       │등록 5 · 판매 3 · ⭐4.5              ││
│  │─────────────────────────────────────────────────────────││
│  │┌───┐│U-9874 │이영희 │younghee@kakao..│1달전  │관리│⋮  ││
│  ││👤 │├───────┼──────┼────────────────┼──────┼────┼───││
│  │└───┘│       │등록 0 · 판매 0 · 관리자             ││
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ◀  1  2  3 ... 98  ▶                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘

액션 메뉴:
┌──────────────┐
│ 👤 프로필보기 │
│ 📦 판매상품   │
│ 📊 활동통계   │
│ ⚙️ 권한변경   │
│ 🚫 계정정지   │
│ 🗑️ 계정삭제   │
└──────────────┘
```

**사용자 관리 기능**:
```typescript
// 권한 변경
async function updateUserRole(
  userId: string,
  role: 'user' | 'admin' | 'moderator'
) {
  const { error } = await supabase
    .from('users')
    .update({ role })
    .eq('id', userId);

  if (error) throw error;

  await supabase.from('admin_logs').insert({
    admin_id: currentAdmin.id,
    action: 'update_user_role',
    target_type: 'user',
    target_id: userId,
    details: { role },
    created_at: new Date().toISOString(),
  });
}

// 계정 정지
async function suspendUser(
  userId: string,
  reason: string,
  duration: number // 일 단위
) {
  const suspendedUntil = new Date();
  suspendedUntil.setDate(suspendedUntil.getDate() + duration);

  const { error } = await supabase
    .from('users')
    .update({
      status: 'suspended',
      suspended_until: suspendedUntil.toISOString(),
      suspended_reason: reason,
    })
    .eq('id', userId);

  if (error) throw error;

  // 사용자에게 알림
  await sendNotification(userId, 'account_suspended', {
    reason,
    until: suspendedUntil,
  });
}
```

---

### 3.5 화면 4: 거래 관리

**목적**: 거래 추적 및 통계

**레이아웃**:
```
┌─────────────────────────────────────────────────────────────┐
│ 거래 관리 > 거래 내역                                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  기간: [2025.10.23 ~ 2025.10.30 ▼]  [상태 ▼]     [📥 내보내기]│
│                                                             │
│  이번 주 거래 요약                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ 총 거래 건수  │  │ 총 거래액    │  │ 평균 거래액  │     │
│  │     156건    │  │  3,450만원   │  │   22만원     │     │
│  │  ↑ 12% vs 지난주│  │↑ 8% vs 지난주│  │↓ 3% vs 지난주│     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                             │
│  거래 목록 (156개)                                           │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ID     │ 상품명       │ 판매자→구매자│ 금액  │상태│일시││
│  │────────┼─────────────┼─────────────┼──────┼───┼───││
│  │T-5678  │아이폰 13 Pro │홍길동→김철수 │80만원 │✅ │2시간││
│  │────────┼─────────────┼─────────────┼──────┼───┼───││
│  │T-5677  │갤럭시 버즈   │김철수→이영희 │12만원 │✅ │5시간││
│  │────────┼─────────────┼─────────────┼──────┼───┼───││
│  │T-5676  │맥북 프로 M1  │이영희→박민수 │210만원│🟡 │1일 ││
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  카테고리별 거래 통계                                        │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  전자기기 ████████████████████ 45% (70건)            │  │
│  │  의류패션 ████████████ 25% (39건)                    │  │
│  │  디지털가전 ████████ 18% (28건)                      │  │
│  │  도서문구 ████ 8% (12건)                             │  │
│  │  기타 ██ 4% (7건)                                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 3.6 화면 5: 통계 분석

**목적**: 데이터 기반 인사이트 제공

**레이아웃**:
```
┌─────────────────────────────────────────────────────────────┐
│ 통계 분석 > 판매 통계                                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  기간 선택: [최근 7일 ▼]  [최근 30일]  [최근 90일]  [사용자정의]│
│                                                             │
│  판매 트렌드                                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  거래액                   거래 건수                   │  │
│  │  (만원)                   (건)                        │  │
│  │  500│                     50│                  ●     │  │
│  │  400│              ●      40│          ●             │  │
│  │  300│      ●               30│  ●                    │  │
│  │  200│                      20│                       │  │
│  │  100│                      10│                       │  │
│  │     └───────────────────  └───────────────────────  │  │
│  │      월 화 수 목 금 토 일      월 화 수 목 금 토 일  │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  인기 상품 TOP 10                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 순위│ 상품명           │ 카테고리  │ 판매수│ 총액    ││
│  │─────┼─────────────────┼──────────┼──────┼────────││
│  │  1  │ 아이폰 13 Pro    │ 전자기기  │  12  │ 960만원 ││
│  │  2  │ 갤럭시 S23       │ 전자기기  │  10  │ 850만원 ││
│  │  3  │ 에어팟 프로      │ 전자기기  │  15  │ 360만원 ││
│  │  4  │ 맥북 에어 M2     │ 디지털가전│   5  │ 650만원 ││
│  │  5  │ 아이패드 프로    │ 디지털가전│   7  │ 560만원 ││
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  지역별 거래 분석                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  서울시 ████████████████████████ 65% (102건)         │  │
│  │  경기도 ████████████ 20% (31건)                      │  │
│  │  부산시 ████ 8% (12건)                               │  │
│  │  기타 ██ 7% (11건)                                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**통계 데이터 로딩**:
```typescript
interface SalesStatistics {
  period: { start: Date; end: Date };
  totalSales: number;
  totalTransactions: number;
  averagePrice: number;
  trends: { date: string; amount: number; count: number }[];
  topProducts: {
    id: string;
    name: string;
    category: string;
    salesCount: number;
    totalAmount: number;
  }[];
  categoryBreakdown: { category: string; count: number; percentage: number }[];
  regionBreakdown: { region: string; count: number; percentage: number }[];
}

async function fetchSalesStatistics(
  startDate: Date,
  endDate: Date
): Promise<SalesStatistics> {
  const { data, error } = await supabase.rpc('get_sales_statistics', {
    start_date: startDate.toISOString(),
    end_date: endDate.toISOString(),
  });

  if (error) throw error;

  return data;
}
```

---

## 📊 차트 및 시각화

### 4.1 차트 라이브러리

```typescript
// Recharts 사용
import { LineChart, Line, BarChart, Bar, PieChart, Pie, XAxis, YAxis, Tooltip } from 'recharts';

// 라인 차트 예시
function SalesTrendChart({ data }: { data: any[] }) {
  return (
    <LineChart width={600} height={300} data={data}>
      <XAxis dataKey="date" />
      <YAxis />
      <Tooltip />
      <Line type="monotone" dataKey="amount" stroke="#2563eb" />
      <Line type="monotone" dataKey="count" stroke="#10b981" />
    </LineChart>
  );
}

// 바 차트
function CategoryChart({ data }: { data: any[] }) {
  return (
    <BarChart width={600} height={300} data={data}>
      <XAxis dataKey="category" />
      <YAxis />
      <Tooltip />
      <Bar dataKey="count" fill="#2563eb" />
    </BarChart>
  );
}
```

---

## 🔐 권한 관리

### 5.1 역할 기반 접근 제어 (RBAC)

```typescript
enum AdminRole {
  SUPER_ADMIN = 'super_admin',    // 모든 권한
  ADMIN = 'admin',                // 일반 관리 권한
  MODERATOR = 'moderator',        // 콘텐츠 관리 권한
  VIEWER = 'viewer',              // 조회만 가능
}

interface Permission {
  resource: string;
  actions: ('create' | 'read' | 'update' | 'delete')[];
}

const rolePermissions: Record<AdminRole, Permission[]> = {
  [AdminRole.SUPER_ADMIN]: [
    { resource: '*', actions: ['create', 'read', 'update', 'delete'] },
  ],
  [AdminRole.ADMIN]: [
    { resource: 'products', actions: ['read', 'update', 'delete'] },
    { resource: 'users', actions: ['read', 'update'] },
    { resource: 'transactions', actions: ['read'] },
    { resource: 'reports', actions: ['read', 'update'] },
  ],
  [AdminRole.MODERATOR]: [
    { resource: 'products', actions: ['read', 'update'] },
    { resource: 'reports', actions: ['read', 'update'] },
  ],
  [AdminRole.VIEWER]: [
    { resource: '*', actions: ['read'] },
  ],
};

function checkPermission(
  role: AdminRole,
  resource: string,
  action: string
): boolean {
  const permissions = rolePermissions[role];

  return permissions.some(
    (perm) =>
      (perm.resource === '*' || perm.resource === resource) &&
      perm.actions.includes(action as any)
  );
}
```

### 5.2 RLS 정책

```sql
-- 관리자만 접근 가능
CREATE POLICY "Admin only access"
ON admin_logs
FOR ALL
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM users
    WHERE users.id = auth.uid()
    AND users.role IN ('super_admin', 'admin', 'moderator')
  )
);
```

---

## 📱 실시간 업데이트

### 6.1 Supabase Realtime

```typescript
// 실시간 상품 업데이트 구독
useEffect(() => {
  const subscription = supabase
    .channel('products')
    .on(
      'postgres_changes',
      { event: 'INSERT', schema: 'public', table: 'products' },
      (payload) => {
        // 새 상품 등록 알림
        showNotification('새 상품이 등록되었습니다!', payload.new);
        revalidateProducts();
      }
    )
    .on(
      'postgres_changes',
      { event: 'UPDATE', schema: 'public', table: 'products' },
      (payload) => {
        // 상품 업데이트
        updateProductInList(payload.new);
      }
    )
    .subscribe();

  return () => {
    subscription.unsubscribe();
  };
}, []);

// 신고 알림
useEffect(() => {
  const subscription = supabase
    .channel('reports')
    .on(
      'postgres_changes',
      { event: 'INSERT', schema: 'public', table: 'reports' },
      (payload) => {
        // 새 신고 알림
        showAlert('⚠️ 새로운 신고가 접수되었습니다!', payload.new);
        playNotificationSound();
      }
    )
    .subscribe();

  return () => {
    subscription.unsubscribe();
  };
}, []);
```

---

## 📤 데이터 내보내기

### 7.1 CSV/Excel 내보내기

```typescript
import { saveAs } from 'file-saver';
import * as XLSX from 'xlsx';

async function exportProductsToCSV(filters: any) {
  const products = await fetchAllProducts(filters);

  const csv = [
    ['ID', '상품명', '판매자', '카테고리', '가격', '상태', '등록일'].join(','),
    ...products.map((p) =>
      [
        p.id,
        p.title,
        p.seller.name,
        p.category.name,
        p.price,
        p.status,
        p.created_at,
      ].join(',')
    ),
  ].join('\n');

  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  saveAs(blob, `products_${new Date().toISOString()}.csv`);
}

async function exportToExcel(data: any[], sheetName: string, fileName: string) {
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, sheetName);

  const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
  const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

  saveAs(blob, fileName);
}
```

---

## 🔔 알림 시스템

### 8.1 관리자 알림

```typescript
interface AdminNotification {
  id: string;
  type: 'new_product' | 'new_user' | 'new_report' | 'system_alert';
  title: string;
  message: string;
  priority: 'low' | 'medium' | 'high';
  read: boolean;
  created_at: Date;
  link?: string;
}

// 알림 생성
async function createAdminNotification(notification: Omit<AdminNotification, 'id' | 'created_at'>) {
  const { data, error } = await supabase
    .from('admin_notifications')
    .insert({
      ...notification,
      created_at: new Date().toISOString(),
    })
    .select()
    .single();

  if (error) throw error;

  // 실시간 푸시
  await supabase
    .channel('admin_notifications')
    .send({
      type: 'broadcast',
      event: 'new_notification',
      payload: data,
    });

  return data;
}
```

---

## 🛡️ 보안 및 감사

### 9.1 활동 로그

```typescript
interface AdminLog {
  id: string;
  admin_id: string;
  action: string;
  target_type: 'product' | 'user' | 'transaction' | 'report' | 'system';
  target_id: string;
  details: any;
  ip_address: string;
  user_agent: string;
  created_at: Date;
}

async function logAdminAction(
  action: string,
  targetType: string,
  targetId: string,
  details?: any
) {
  await supabase.from('admin_logs').insert({
    admin_id: currentAdmin.id,
    action,
    target_type: targetType,
    target_id: targetId,
    details,
    ip_address: await getClientIP(),
    user_agent: navigator.userAgent,
    created_at: new Date().toISOString(),
  });
}
```

---

## 📈 성능 최적화

### 10.1 데이터 페이지네이션

```typescript
const PAGE_SIZE = 50;

async function fetchPaginatedData(
  table: string,
  page: number,
  filters?: any
) {
  const from = page * PAGE_SIZE;
  const to = from + PAGE_SIZE - 1;

  let query = supabase
    .from(table)
    .select('*', { count: 'exact' });

  // 필터 적용
  if (filters) {
    Object.entries(filters).forEach(([key, value]) => {
      if (value) {
        query = query.eq(key, value);
      }
    });
  }

  const { data, error, count } = await query
    .range(from, to)
    .order('created_at', { ascending: false });

  if (error) throw error;

  return {
    data,
    totalCount: count,
    totalPages: Math.ceil((count || 0) / PAGE_SIZE),
    currentPage: page,
  };
}
```

---

## 🎨 UI 컴포넌트

### 11.1 관리자 전용 컴포넌트

```typescript
// KPI 카드
function KPICard({ title, value, change, icon }: KPICardProps) {
  const isPositive = change >= 0;

  return (
    <div className="kpi-card">
      <div className="icon">{icon}</div>
      <div className="content">
        <p className="title">{title}</p>
        <h2 className="value">{value}</h2>
        <p className={`change ${isPositive ? 'positive' : 'negative'}`}>
          {isPositive ? '↑' : '↓'} {Math.abs(change)}% vs 어제
        </p>
      </div>
    </div>
  );
}

// 데이터 테이블
function DataTable({ columns, data, actions }: DataTableProps) {
  return (
    <table className="data-table">
      <thead>
        <tr>
          {columns.map((col) => (
            <th key={col.key}>{col.label}</th>
          ))}
          {actions && <th>액션</th>}
        </tr>
      </thead>
      <tbody>
        {data.map((row, index) => (
          <tr key={index}>
            {columns.map((col) => (
              <td key={col.key}>{col.render ? col.render(row) : row[col.key]}</td>
            ))}
            {actions && <td>{actions(row)}</td>}
          </tr>
        ))}
      </tbody>
    </table>
  );
}
```

---

**문서 버전**: 1.0
**최종 수정일**: 2025-10-30
**작성자**: 에버세컨즈 개발팀
**관련 문서**: [프로젝트 개요](./프로젝트_개요.md)
