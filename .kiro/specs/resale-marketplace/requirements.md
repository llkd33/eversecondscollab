# 요구사항 문서

## 소개

개인 간 중고거래에 "대신팔기" 기능을 도입한 중개형 마켓플레이스입니다. 사용자는 자신의 상품을 직접 판매하거나, 다른 사람의 상품을 대신 판매하여 수수료를 받을 수 있습니다. 모바일 앱에서는 전체 기능을, 웹(키오스크)에서는 상품 조회 및 QR 연결 기능을 제공하며, 안전거래 시스템을 통해 신뢰할 수 있는 거래 환경을 구축합니다.

## 요구사항

### 요구사항 1: 사용자 인증 및 회원가입

**사용자 스토리:** 사용자로서 카카오 로그인 또는 핸드폰 번호로 간편하게 회원가입하고 싶습니다. 그래야 안전하고 신뢰할 수 있는 거래를 할 수 있습니다.

#### 승인 기준
1. WHEN 사용자가 카카오 로그인을 선택하면 THEN 시스템은 카카오 SDK를 통해 이름, 전화번호, 프로필 정보를 자동으로 가져와야 합니다
2. WHEN 사용자가 핸드폰 번호 로그인을 선택하면 THEN 시스템은 SMS 인증번호를 발송하고 본인 확인을 해야 합니다
3. WHEN 전화번호가 이미 등록된 경우 THEN 시스템은 중복 가입을 방지해야 합니다
4. WHEN 회원가입이 완료되면 THEN 시스템은 email을 사용자 ID로 부여하되, 카카오/전화번호 로그인 시 아이디 값을 변경하여 활용해야 합니다
5. WHEN 사용자 정보가 저장될 때 THEN 시스템은 name, phone, is_verified, profile_image, role(일반/대신판매자/관리자)을 저장해야 합니다

### 요구사항 2: 상품 등록 및 관리

**사용자 스토리:** 판매자로서 상품을 쉽게 등록하고 대신팔기 옵션을 설정하고 싶습니다. 그래야 더 많은 판매 기회를 얻을 수 있습니다.

#### 승인 기준
1. WHEN 사용자가 상품을 등록할 때 THEN 시스템은 title, price, description, images(리스트), category를 입력받아야 합니다
2. WHEN 상품 등록 시 THEN 시스템은 resale_enabled 여부와 resale_fee(퍼센티지로 입력하되 자동 계산하여 금액으로 적용)를 설정할 수 있어야 합니다
3. WHEN 상품이 등록되면 THEN 시스템은 status를 '판매중'으로 설정해야 합니다
4. WHEN 판매자가 거래완료 버튼을 클릭하면 THEN 시스템은 status를 '판매완료'로 변경해야 합니다
5. WHEN 상품 리스트를 조회할 때 THEN 시스템은 기본적으로 최신순으로 정렬하여 표시해야 합니다

### 요구사항 3: 대신팔기 기능

**사용자 스토리:** 대신판매자로서 다른 사람의 상품을 내 샵에 진열하고 판매하여 수수료를 받고 싶습니다. 그래야 추가 수익을 창출할 수 있습니다.

#### 승인 기준
1. WHEN 사용자가 대신팔기를 선택하면 THEN 시스템은 해당 상품을 사용자의 Shop에 resale_products로 추가해야 합니다
2. WHEN 대신판매 수수료를 설정할 때 THEN 시스템은 제한 없이 퍼센티지 입력을 허용하고 상품 금액에 자동 계산하여 표시해야 합니다
3. WHEN 개인 샵이 생성되면 THEN 시스템은 URL로 공유 가능한 링크를 제공해야 합니다
4. WHEN 대신판매 상품의 거래가 발생하면 THEN 시스템은 채팅창에 "ㅇㅇㅇ님에 의해 대신판매되는 거래"라고 명시해야 합니다
5. WHEN 대신판매자가 수수료 정보를 확인할 때 THEN 시스템은 본인 마이페이지에서 수수료 금액이나 퍼센티지를 확인할 수 있는 구조를 제공해야 합니다

### 요구사항 4: 홈화면 및 상품 탐색

**사용자 스토리:** 구매자로서 다양한 상품을 쉽게 찾고 비교하고 싶습니다. 그래야 원하는 상품을 빠르게 구매할 수 있습니다.

#### 승인 기준
1. WHEN 홈화면에 접속하면 THEN 시스템은 상품 리스트를 카드 UI로 표시해야 합니다 (썸네일, 제목, 가격, 판매자명)
2. WHEN 사용자가 카테고리를 선택하면 THEN 시스템은 의류, 전자기기, 생활용품 등으로 필터링해야 합니다
3. WHEN 검색 기능을 사용하면 THEN 시스템은 상품명, 태그, 판매자명으로 검색 결과를 제공해야 합니다
4. WHEN 웹뷰에서 결제 버튼을 누르면 THEN 시스템은 "앱 설치 QR" 팝업을 표시해야 합니다
5. WHEN 상품 정렬 시 THEN 시스템은 초기에는 최신 등록순으로 표시해야 합니다

### 요구사항 5: 실시간 채팅 시스템

**사용자 스토리:** 구매자와 판매자로서 실시간으로 소통하여 거래 조건을 협상하고 싶습니다. 그래야 안전하고 원활한 거래를 할 수 있습니다.

#### 승인 기준
1. WHEN 구매자가 상품에 관심을 표시하면 THEN 시스템은 participants, messages, transaction을 포함한 Chat을 생성해야 합니다
2. WHEN 채팅방 상단에 THEN 시스템은 안전거래/일반거래 버튼 두 개를 표시하고 "안전한 거래를 하기 원하시면 안전거래로 거래하세요" 안내를 제공해야 합니다
3. WHEN 안전거래를 선택하면 THEN 시스템은 법인 계좌 입금 안내와 함께 "입금확인 요청" 버튼과 "닫기" 버튼을 제공해야 합니다
4. WHEN 입금확인 요청 버튼을 클릭하면 THEN 시스템은 관리자 핸드폰으로 어떤 고객이 어떤 상품에 얼마를 입금했는지 문자를 발송해야 합니다
5. WHEN 채팅 메시지를 전송할 때 THEN 시스템은 sender, content를 Message로 저장해야 합니다

### 요구사항 6: 안전거래 및 결제 시스템

**사용자 스토리:** 구매자로서 안전하게 결제하고 상품을 받은 후 판매자에게 돈이 전달되기를 원합니다. 그래야 사기 위험 없이 거래할 수 있습니다.

#### 승인 기준
1. WHEN 관리자가 입금을 확인하면 THEN 시스템은 어드민에서 입금 확인 버튼을 클릭하여 상품 등록자와 대신 판매자에게 입금 완료 문자를 발송해야 합니다
2. WHEN 상품 등록자가 상품을 발송하면 THEN 시스템은 상품 정보와 함께 배송 완료 버튼을 클릭하여 구매자에게 배송정보 문자를 발송해야 합니다
3. WHEN 구매자가 상품을 받으면 THEN 시스템은 완료 버튼을 눌러 회사에 거래 정상 처리 문자를 발송해야 합니다
4. WHEN 일반거래를 선택하면 THEN 시스템은 거래 완료 시 판매자가 알아서 거래완료 처리하도록 해야 합니다
5. WHEN 어드민에서 정산 처리를 완료하면 THEN 시스템은 안전거래 관리 DB를 정산 완료 상태로 업데이트해야 합니다

### 요구사항 7: 후기 및 리뷰 시스템

**사용자 스토리:** 거래 참여자로서 거래 완료 후 상대방에 대한 후기를 남기고 싶습니다. 그래야 신뢰할 수 있는 거래 환경을 만들 수 있습니다.

#### 승인 기준
1. WHEN 거래가 완료되면 THEN 시스템은 판매자/구매자가 서로 리뷰를 남길 수 있도록 해야 합니다(강제는 아님)
2. WHEN 대신판매 거래가 완료되면 THEN 시스템은 대신 홍보한 사람과 상품을 갖고 있는 사람도 서로 리뷰를 남길 수 있도록 해야 합니다
3. WHEN 거래 완료 처리를 할 때 THEN 시스템은 상품 등록한 사람(판매자)이 거래완료를 눌러야 하는 구조를 제공해야 합니다
4. WHEN 리뷰를 작성할 때 THEN 시스템은 reviewer, transaction, comment를 Review로 저장해야 합니다
5. WHEN 사용자 프로필을 조회할 때 THEN 시스템은 받은 리뷰 목록을 표시해야 합니다

### 요구사항 8: 마이페이지 및 거래 관리

**사용자 스토리:** 사용자로서 내 활동 내역과 거래 현황을 한눈에 보고 관리하고 싶습니다. 그래야 효율적으로 거래 활동을 할 수 있습니다.

#### 승인 기준
1. WHEN 마이페이지에 접속하면 THEN 시스템은 내 프로필 정보, 내 샵 보기, 내 상품 관리, 내 거래내역을 표시해야 합니다
2. WHEN 내 거래내역을 조회하면 THEN 시스템은 구매내역/판매내역/대신팔기 내역을 구분하여 표시해야 합니다
3. WHEN 내 샵을 확인하면 THEN 시스템은 등록 상품 목록과 대신팔기 상품 목록을 구분하여 표시해야 합니다
4. WHEN 샵 페이지에서 THEN 시스템은 샵 소유자 프로필, 공유 URL, 공유 기능을 제공해야 합니다
5. WHEN Transaction을 생성할 때 THEN 시스템은 product, price, resale_fee, buyer, seller, reseller(있을 경우), status, chat을 포함해야 합니다

### 요구사항 9: 관리자 시스템

**사용자 스토리:** 관리자로서 플랫폼의 사용자, 거래, 안전거래를 효율적으로 관리하고 싶습니다. 그래야 건전한 거래 환경을 유지할 수 있습니다.

#### 승인 기준
1. WHEN 관리자가 웹 어드민에 로그인하면 THEN 시스템은 유저 관리, 상품 관리, 거래 현황을 대시보드로 제공해야 합니다
2. WHEN 입금확인 요청이 들어오면 THEN 시스템은 회사 어드민 안전거래 관리 DB를 생성하고 담당자에게 문자를 발송해야 합니다
3. WHEN 어드민에서 입금 확인 버튼을 클릭하면 THEN 시스템은 상품 등록자와 대신 판매자에게 입금 완료 및 배송 안내 문자를 발송해야 합니다
4. WHEN 거래가 완료되면 THEN 시스템은 어드민에서 정산 준비 단계로 이동하고 정산 처리 정보를 관리해야 합니다
5. WHEN 정산 완료 후 THEN 시스템은 어드민에서 정산 완료 버튼을 클릭하여 최종 처리를 완료해야 합니다

### 요구사항 10: 크로스 플랫폼 지원

**사용자 스토리:** 사용자로서 모바일 앱에서는 모든 기능을, 웹에서는 상품 조회 기능을 이용하고 싶습니다. 그래야 다양한 환경에서 서비스를 이용할 수 있습니다.

#### 승인 기준
1. WHEN Flutter 앱을 사용하면 THEN 시스템은 모든 거래/채팅/결제 기능을 제공해야 합니다
2. WHEN 웹(키오스크)에서 홈 페이지에 접속하면 THEN 시스템은 상품 카드 목록(썸네일/가격/판매자명), 카테고리/검색 필터만 제공하고 로그인/거래 버튼은 없어야 합니다
3. WHEN 웹에서 상품 상세 페이지에 접속하면 THEN 시스템은 판매자 정보, 이미지 슬라이드, 설명, 가격을 표시해야 합니다
4. WHEN 웹에서 구매하기 또는 대신팔기 버튼을 클릭하면 THEN 시스템은 "앱 설치 QR 팝업"을 표시해야 합니다
5. WHEN 키오스크 사이즈에 맞춰 THEN 시스템은 반응형 디자인을 제공해야 합니다